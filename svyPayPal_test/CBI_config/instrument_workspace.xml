<?xml version="1.0"?>

<!-- Works with Ant 1.7.0 and higher -->
<project basedir=".">

    <property file="export_and_test_personal.properties"/>
    <property file="export_and_test.properties"/>

	<echo message="Hello, istanbul"/>
	<echo>${WORKSPACE}</echo>
	<echo>${INSTRUMENTED_WORKSPACE}</echo>
	
	<target name="instrument_code" depends= "test_create_dir, instrument_workspace"/>
	
	<target name="remove_instrumented_directory">
	  <exec executable="cmd">
		<arg value="rd"/>
		<arg value="${INSTRUMENTED_WORKSPACE}"/>
		<arg value="/S"/>
		<arg value="/Q"/>
	  </exec>
	</target>
	
	<target name="create_instrumented_directrory">
	  <exec executable="cmd">
		<arg value="mkdir"/>
		<arg value="${INSTRUMENTED_WORKSPACE}"/>
	  </exec>
	</target>
	
	<!--
	<target name="copy_workspace_into_instrumented_directrory">
	  <exec executable="cmd">
		<arg value="mkdir"/>
		<arg value="${INSTRUMENTED_WORKSPACE}"/>
	  </exec>
	</target>
	-->
	
	<target name="test_create_dir">
	  <mkdir dir="${INSTRUMENTED_WORKSPACE}"/>
	  <mkdir dir="${WORKSPACE}/istanbul_test"/>
	  <!--
	  <exec executable="cmd">
		<arg line="/c mkdir ${WORKSPACE}/istanbul_test"/>
	  </exec>
	  -->
	</target>
	
	<!-- Instrument all code in workspace -->
	<target name="instrument_workspace" depends="test_create_dir">
	  <exec executable="cmd">
		<arg line="/c istanbul instrument ${WORKSPACE} --output ${INSTRUMENTED_WORKSPACE}"/>
	  </exec>
	</target>
	
</project>