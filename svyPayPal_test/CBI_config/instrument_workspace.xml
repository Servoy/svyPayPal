<?xml version="1.0"?>

<!-- Works with Ant 1.7.0 and higher -->
<project basedir=".">

    <property file="export_and_test_personal.properties"/>
    <property file="export_and_test.properties"/>

	<target name="instrument_code" depends= "clean_instrumented_workspace, instrument_workspace"/>

	<!-- clean the instrumented workspace -->
	<target name="clean_instrumented_workspace">
	  <echo message="clean instrumented workspace"/>
	  <delete dir="${INSTRUMENTED_WORKSPACE}"/>
	  <mkdir dir="${INSTRUMENTED_WORKSPACE}"/>
	  <mkdir dir="${WORKSPACE}/istanbul_test"/>
	</target>
	
	<!-- instrument all code from workspace into the instrumented workspace-->
	<target name="instrument_workspace" depends="clean_instrumented_workspace">
	  <exec executable="cmd">
		<arg line="npm install -g istanbul"/>
	  </exec>
	  <echo level="info" message="istanbul ${WORKSPACE} --output ${INSTRUMENTED_WORKSPACE}"/>
	  <exec executable="cmd">
		<arg line="/c istanbul instrument ${WORKSPACE} --output ${INSTRUMENTED_WORKSPACE}"/>
	  </exec>
	  <echo message="re-execute istanbul">
	</target>
	
</project>